language: c

compiler:
  - gcc

integrations:
  notifications:
    - integrationName: email
      type: email
      on_success: never
      on_failure: change
      on_cancel: never
      on_pull_request: never


build:
  ci:
    - apt-get update -qq

    # install python packages
    - apt-get install -y -qq python3-pip
    - pip3 install numpy scipy matplotlib jupyter

    # install kima and pykima
    - git clone --recursive https://github.com/j-faria/kima.git
    - cd kima
    - make -j 2
    - python3 setup.py install
    - cd ..

    # run kima on the examples
    - if [ "$BRANCH" == "master" ]; then ./run-kima-examples.sh; fi

    # it's a pull request
    - if [ "$IS_PULL_REQUEST" == true ]; then python3 run-pull-request.py; fi


    # push it back to github
    - git config user.email "joao.faria@astro.up.pt"
    - git config user.name "Jo√£o Faria"
    - git config --global push.default simple
    - git remote set-url origin git@github.com:j-faria/kima-them-all.git

    - if [ "$BRANCH" == "master" ]; then ./push-examples.sh; fi
    - if [ "$IS_PULL_REQUEST" == true ]; then ./push-pull-request.sh; fi

